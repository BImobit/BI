<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foto â†’ 480p â†’ Base64</title>
<style>
  body{font-family:system-ui;background:#0b0f19;color:#e5e7eb;padding:16px}
  button{padding:10px 14px;border-radius:10px;border:1px solid #374151;background:#0b0f19;color:#e5e7eb}
  textarea{width:100%;min-height:170px;margin-top:10px;background:#020617;color:#e5e7eb;border:1px solid #1f2937;border-radius:12px;padding:10px;font-family:monospace;font-size:12px}
  img{max-width:100%;margin-top:10px;border-radius:12px;border:1px solid #1f2937}
  .info{margin-top:8px;font-size:12px;color:#9ca3af}
</style>
</head>
<body>

<h3>ðŸ“¸ Foto â†’ 480p fixo â†’ Base64</h3>

<input type="file" id="cam" accept="image/*" capture="environment">
<button id="copy" disabled>Copiar Base64</button>

<div class="info" id="info"></div>

<img id="preview" style="display:none">
<textarea id="out" placeholder="Base64 da imagem em 480p"></textarea>

<script>
const cam = document.getElementById("cam");
const out = document.getElementById("out");
const preview = document.getElementById("preview");
const info = document.getElementById("info");
const copyBtn = document.getElementById("copy");

const TARGET = 480; // ðŸ‘ˆ SEMPRE 480p (lado maior)

function human(bytes){
  const u=["B","KB","MB"]; let i=0;
  while(bytes>=1024 && i<u.length-1){ bytes/=1024; i++; }
  return bytes.toFixed(i?2:0)+" "+u[i];
}

cam.addEventListener("change", async () => {
  const file = cam.files[0];
  if (!file) return;

  info.textContent = "Processandoâ€¦";

  const img = new Image();
  img.src = URL.createObjectURL(file);
  await img.decode();

  const ratio = img.width / img.height;

  let w, h;
  if (img.width >= img.height) {
    w = TARGET;
    h = Math.round(TARGET / ratio);
  } else {
    h = TARGET;
    w = Math.round(TARGET * ratio);
  }

  const canvas = document.createElement("canvas");
  canvas.width = w;
  canvas.height = h;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, w, h);

  canvas.toBlob(blob => {
    const reader = new FileReader();
    reader.onload = () => {
      out.value = reader.result;
      preview.src = reader.result;
      preview.style.display = "block";
      copyBtn.disabled = false;

      info.innerHTML = `
        Original: ${img.width}Ã—${img.height} â€” ${human(file.size)}<br>
        480p: ${w}Ã—${h} â€” ${human(blob.size)}
      `;
    };
    reader.readAsDataURL(blob);
  }, "image/jpeg", 0.8); // ðŸ”§ qualidade 80%
});

copyBtn.onclick = async () => {
  await navigator.clipboard.writeText(out.value);
  copyBtn.textContent = "Copiado âœ…";
  setTimeout(()=>copyBtn.textContent="Copiar Base64",1500);
};
</script>

</body>
</html>
